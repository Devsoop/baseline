{% comment %}
  Premium Product Info Block
  Add this as a block in your main-product.liquid section
{% endcomment %}

<style>
  .premium-info-block-wrapper{
    color: #ffffff;
  }
  .premium-info-block-wrapper p{
    text-align: center;
  }
  .premium-info-block-wrapper ul{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding-left: 0;
    list-style: none;
  }
  .premium-info-block-wrapper ul li{
    display: flex;
    align-items: center;
    gap: 8px;
    color: #ffffff;
    font-size: 16px;
    font-weight: 600;
    line-height: 100%;
    font-family: var(--font-body-family);
  }
  .premium-info-block-wrapper ul li::before{
    content: '';
    display: inline-block;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    background-image: url("data:image/svg+xml;utf8,<svg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'><path fill='white' d='M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z'></path></svg>");
  }
  .premium-info-block-{{ block.id }} {
    background: {{ block.settings.background_color }};
    padding: 24px;
    {% comment %} border-radius: {{ block.settings.border_radius }}px; {% endcomment %}
    margin-top: {{ block.settings.margin_top }}px;
    transition: all 0.3s ease;
    position: relative;
  }

  .premium-offer-container-{{ block.id }} {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding: 20px;
    background: {{ block.settings.offer_bg_color }};
    {% comment %} border-radius: 8px; {% endcomment %}
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .premium-offer-container-{{ block.id }}:hover {
    transform: translateY(-2px);
  }

  .premium-offer-left-{{ block.id }} {
    display: flex;
    align-items: center;
    gap: 20px;
    flex: 1;
  }

  .premium-offer-text-{{ block.id }} h3 {
    max-width:200px;
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.title_font_size }}px;
    line-height:22px;
    letter-spacing:2%;
    margin: 0 0 4px 0;
    font-weight: 600;
    font-family: var(--font-heading-family);
  }
  .premium-offer-text-{{ block.id }}{
    display:flex;
    align-items:center;
    gap:20px;
  }

  .premium-offer-right-{{ block.id }} {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .premium-price-{{ block.id }} {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .original-price-{{ block.id }} {
    color: {{ block.settings.text_color }};
    text-decoration: line-through;
    font-size: 14px;
    opacity: 0.7;
  }

  .free-price-{{ block.id }} {
    color: {{ block.settings.free_text_color }};
    font-size: 18px;
    font-weight: 600;
    line-height:22px;
    font-family: var(--font-heading-family);
  }

  .info-toggle-{{ block.id }} {
    width: 24px;
    height: 24px;
    border: 2px solid {{ block.settings.text_color }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: {{ block.settings.text_color }};
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
  }

  .info-toggle-{{ block.id }}:hover {
    background: {{ block.settings.text_color }};
    color: {{ block.settings.background_color }};
  }

  .premium-product-visual-{{ block.id }} {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    margin-bottom: 0;
  }

  .premium-product-visual-{{ block.id }}.active {
    max-height: 500px;
    opacity: 1;
    margin-bottom: 20px;
  }

  .product-showcase-{{ block.id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 30px;
    padding: 40px 20px;
    background: {{ block.settings.showcase_bg }};
    {% comment %} border-radius: 8px; {% endcomment %}
  }

  .product-image-container-{{ block.id }} {
    flex: 0 0 auto;
    max-width: 200px;
  }

  .product-image-container-{{ block.id }} img {
    width: 100%;
    height: auto;
    object-fit: contain;
  }

  .plus-icon-{{ block.id }} {
    font-size: 40px;
    color: {{ block.settings.text_color }};
    font-weight: 300;
  }

  .product-badges-{{ block.id }} {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
  }

  .badge-{{ block.id }} {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid {{ block.settings.badge_border_color }};
    color: {{ block.settings.badge_text_color }};
    padding: 4px 12px 2px 12px;
    border-radius: 20px;
    font-size: 12px;
    line-height:22px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 6%;
    font-family: var(--font-body-family);
  }



  .delivery-info-{{ block.id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 20px 12px;
    background: {{ block.settings.offer_bg_color }};
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.delivery_font_size }}px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 6%;
    line-height:120%;
    font-family: var(--font-body-family);

    width: 100%;
  }

  .delivery-info-{{ block.id }} svg {
    width: 20px;
    height: 20px;
    fill: {{ block.settings.text_color }};
  }

  @media (max-width: 950px){
     .premium-offer-container-{{ block.id }} {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
    }
  }

  @media (max-width: 768px) {
    .premium-info-block-{{ block.id }} {
      padding: 16px;
    }



    .premium-offer-left-{{ block.id }} {
      width: 100%;
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }

    .premium-offer-right-{{ block.id }} {
      width: 100%;
      justify-content: space-between;
    }

    .product-showcase-{{ block.id }} {
      flex-direction: column;
      gap: 20px;
      padding: 30px 15px;
    }

    .product-image-container-{{ block.id }} {
      max-width: 150px;
    }

    .premium-benefits-{{ block.id }} {
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .product-badges-{{ block.id }} {
      margin-top: 15px;
    }

    .premium-offer-text-{{ block.id }} h3 {
      {% assign reduced_size = block.settings.title_font_size | minus: 2 %}
      font-size: {{ reduced_size }}px;
    }

    .free-price-{{ block.id }} {
      font-size: 20px;
    }
  }

  @media (max-width: 480px) {
    .product-image-container-{{ block.id }} {
      max-width: 120px;
    }

    .badge-{{ block.id }} {
      font-size: 10px;
      padding: 6px 12px;
    }
  }
</style>

<div class="premium-info-block-{{ block.id }}" {{ block.shopify_attributes }}>
  {% assign variant = product.selected_or_first_available_variant %}
  {% assign current_variant_features = variant.metafields.custom.features | metafield_tag %}
  {%- render 'gifts', product: product, block: block -%}
 

  <div class="premium-benefits-{{ block.id }}">
    {{ current_variant_features }}
  </div>
</div>
{%- if block.settings.delivery_text != blank -%}
  <div class="delivery-info-{{ block.id }}">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M19 7h-3V5c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h1c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h1c1.1 0 2-.9 2-2v-3l-3-4zM7 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12-8.5h-3V7h1.5l1.5 2.5zM19 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
    </svg>
    <span>{{ block.settings.delivery_text }}</span>
  </div>
{%- endif -%}
<script>
  (function () {
    // Event delegation: one listener on document so it works after subscription-change
    // re-renders (innerHTML replace removes the block; delegated listener keeps working).
    if (window.__premiumInfoBlockDelegationAttached) return;
    window.__premiumInfoBlockDelegationAttached = true;

    document.addEventListener('click', function (e) {
      const toggleBtn = e.target.closest('[data-info-toggle]');
      const offerContainer = e.target.closest('[data-offer-toggle]');
      if (!offerContainer && !toggleBtn) return;

      if (e.target.closest('.product-gifts')) return;

      const block = (offerContainer || toggleBtn).closest('[class*="premium-info-block-"]');
      if (!block) return;

      const productVisual = block.querySelector('[data-product-visual]');
      if (!productVisual) return;

      const smallImg = block.querySelector('.product_small_img');
      const iconEl = block.querySelector('[data-info-toggle] .toggle-icon');
      const infoToggleEl = block.querySelector('[data-info-toggle]');

      if (toggleBtn) {
        e.stopPropagation();
      }

      productVisual.classList.toggle('active');

      if (smallImg) {
        smallImg.style.display = productVisual.classList.contains('active') ? 'none' : '';
      }

      if (iconEl && infoToggleEl) {
        if (productVisual.classList.contains('active')) {
          iconEl.textContent = 'Ã—';
          infoToggleEl.style.transform = 'rotate(180deg)';
        } else {
          iconEl.textContent = 'i';
          infoToggleEl.style.transform = 'rotate(0deg)';
        }
      }
    });
  })();
</script>

{% comment %} Script For Hiding and showing Free Gift Div with Variant Change  {% endcomment %}
<script>
  window.variantFreeProduct_{{ block.id }} = {
    {% for variant in product.variants %}
      "{{ variant.id }}": {{ variant.metafields.custom.free_product | json }},
    {% endfor %}
  };

  // Show on initial load if the selected variant qualifies
  (function() {
    var selectedId = {{ product.selected_or_first_available_variant.id }};
    var metafield = window.variantFreeProduct_{{ block.id }}[selectedId];
    if (metafield !== null && metafield !== undefined && metafield !== "") {
      document.querySelector('[data-block-id="{{ block.id }}"]').style.display = "";
    }
  })();
</script>

<script>
    document.addEventListener('change', function(e) {
    // Works with standard Shopify variant selectors and most themes
    if (e.target.name === 'id' || e.target.classList.contains('product-form__input')) {
      var variantId = e.target.value;
      var metafield = window.variantFreeProduct_{{ block.id }}[variantId];
      var container = document.querySelector('[data-block-id="{{ block.id }}"]');
      if (metafield !== null && metafield !== undefined && metafield !== "") {
        container.style.display = "";
      } else {
        container.style.display = "none";
      }
    }
  });

  // Also listen for the 'variant:changed' custom event fired by themes like Dawn
  document.addEventListener('variant:changed', function(e) {
    var variantId = e.detail.variant ? e.detail.variant.id : null;
    if (!variantId) return;
    var metafield = window.variantFreeProduct_{{ block.id }}[variantId];
    var container = document.querySelector('[data-block-id="{{ block.id }}"]');
    container.style.display = (metafield !== null && metafield !== undefined && metafield !== "") ? "" : "none";
  });
</script>
{% comment %} Script For Hiding and showing Free Gift Div with Variant Change -------End  {% endcomment %}
