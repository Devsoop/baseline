{%- style -%}
  .animation-hero-{{ section.id }} {
    background-color: #0a0a0a;
    background-image: radial-gradient(ellipse 80% 50% at 50% 28%, #81091b 0%, #690212 25%, #560410 55%, rgb(99 4 17 / 41%) 85%, transparent 100%);
  }
  .animation-hero-{{ section.id }} .animation-hero__inner {
    position: relative;
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .animation-hero-{{ section.id }} .animation-hero__inner {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  .animation-hero-{{ section.id }} .animation-hero__banner-img-wrap {
    max-width: 100%;
  }
  @media screen and (min-width: 750px) {
    .animation-hero-{{ section.id }} .animation-hero__banner-img-wrap {
      max-width:  100%;
    }
  }

  .animation-hero .hero-bg-linear {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    background: linear-gradient(
      180deg,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 0.15) 35%,
      rgba(0, 0, 0, 0.6) 55%,
      #000000 70%,
      #000000 100%
    );
    pointer-events: none;
  }
  @media screen and (max-width: 991px) {
    .animation-hero-{{ section.id }} .animation-hero__title{
        font-size: 82px;
    }
  }
  @media screen and (max-width: 500px) {
    .animation-hero-{{ section.id }} .animation-hero__title{
        font-size: 62px;
    }
  }
{%- endstyle -%}

<section
  class="animation-hero animation-hero-{{ section.id }}"
  id="AnimationHero-{{ section.id }}"
>
  <div class="animation-hero__inner">
    <div class="hero-bg-linear" aria-hidden="true"></div>
    {%- comment -%} Hero area: heading, bottles, CTA {%- endcomment -%}
    <div class="animation-hero__hero page-width">
      <div class="animation-hero__hero-content">
        {%- if section.settings.hero_heading != blank -%}
          <h1 class="animation-hero__title">{{ section.settings.hero_heading }}</h1>
        {%- endif -%}
        {%- if section.settings.hero_button_text != blank -%}
          <a
            href="{{ section.settings.hero_button_link | default: '#' }}"
            class="animation-hero__btn animation-hero__btn--outline"
          >
            {{ section.settings.hero_button_text }}
          </a>
        {%- endif -%}
      </div>
      {%- if section.settings.hero_banner_image != blank -%}
        <div class="animation-hero__banner">
          <div class="animation-hero__banner-img-wrap">
            {{
              section.settings.hero_banner_image
              | image_url: width: 1200
              | image_tag: loading: 'lazy', class: 'animation-hero__banner-img', alt: section.settings.hero_banner_image.alt | default: 'Hero banner'
            }}
          </div>
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Powered by Polyphenols (animation extends until here) {%- endcomment -%}
    <div class="animation-hero__polyphenols page-width">
      <div class="animation-hero__polyphenols-content">
        {%- if section.settings.polyphenols_heading != blank -%}
          <h2 class="animation-hero__polyphenols-title">{{ section.settings.polyphenols_heading }}</h2>
        {%- endif -%}
        {%- if section.settings.polyphenols_text != blank -%}
          <div class="animation-hero__polyphenols-text rte">
            {{ section.settings.polyphenols_text }}
          </div>
        {%- endif -%}
        {%- if section.settings.polyphenols_button_text != blank -%}
          <a
            href="{{ section.settings.polyphenols_button_link | default: '#' }}"
            class="animation-hero__btn animation-hero__btn--outline"
          >
            {{ section.settings.polyphenols_button_text }}
          </a>
        {%- endif -%}
      </div>
      {%- if section.settings.polyphenols_image != blank -%}
        <div class="animation-hero__polyphenols-media">
          {{
            section.settings.polyphenols_image
            | image_url: width: 600
            | image_tag: loading: 'lazy', class: 'animation-hero__polyphenols-img', alt: section.settings.polyphenols_image.alt | default: 'Polyphenols'
          }}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<style>
  .animation-hero {
    margin-top: -110px;
    color: #fff;
    position: relative;
  }
  .animation-hero__hero {
    text-align: center;
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding-top: 0rem;
    padding-bottom: 0rem;
  }
  .animation-hero__hero-content {
    position: relative;
    z-index: 2;
  }
  .animation-hero__title {
    margin: 0 0 1.5rem;
    font-size: 100px;
    text-transform: uppercase;
    line-height: 1.1;
    color:white;
  }
  .animation-hero__btn {
    display: inline-block;
    padding: 0.75rem 1.75rem;
    font-size: 17px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-decoration: none;
    color: #fff;
    transition: opacity 0.2s;
  }
  .animation-hero__btn:hover { opacity: 0.9; }
  .animation-hero__btn--outline {
    border: 2px solid #fff;
    border-radius: 9999px;
  }
  .animation-hero__banner {
    position: absolute;
    inset: 0;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3;
    max-width: 80%;
    margin: auto;
  }
  .animation-hero__banner-img-wrap {
    width: 100%;
  }
  .animation-hero__banner-img {
    width: 100%;
    height: auto;
    display: block;
  }
  .animation-hero__polyphenols {
    display: grid;
    gap: 2rem;
    align-items: center;
    min-height: 100vh;
    padding-top: 0;
    padding-bottom: 2rem;
  }
  @media (min-width: 990px) {
    .animation-hero__polyphenols {
      grid-template-columns: 66.6% 33%;
      gap: 1rem;
    }
  }
  .animation-hero__polyphenols-title {
    margin: 0 0 1rem;
    font-size: 52px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: white;
  }
  .animation-hero__polyphenols-text {
    margin-bottom: 1.5rem;
    font-size: 24px;
    line-height: 1.6;
    max-width: 100%;
  }
  .animation-hero__polyphenols-text strong { font-weight: 700; }
  .animation-hero__polyphenols-media {
    max-width: 280px;
    margin-left: auto;
    margin-right: auto;
  }
  @media (min-width: 990px) {
    .animation-hero__polyphenols-media { max-width: 320px; }
  }
  .animation-hero__polyphenols-img {
    width: 100%;
    height: auto;
    display: block;
  }
</style>

{%- comment -%} Load GSAP and ScrollTrigger from CDN {%- endcomment -%}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" defer></script>

<script>
  /**
   * Animation Hero - Scroll Triggered Animations
   * This script handles all scroll-based animations for the animation hero section
   */
  (function() {
    'use strict';

    function initAnimationHero() {
      if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') {
        setTimeout(initAnimationHero, 100);
        return;
      }

      gsap.registerPlugin(ScrollTrigger);

      const sections = document.querySelectorAll('[id^="AnimationHero-"]');
      
      sections.forEach((section) => {
        const heroArea = section.querySelector('.animation-hero__hero');
        const heroTitle = section.querySelector('.animation-hero__title');
        const heroButton = section.querySelector('.animation-hero__hero-content .animation-hero__btn');
        const heroBanner = section.querySelector('.animation-hero__banner-img-wrap');
        const polyphenolsSection = section.querySelector('.animation-hero__polyphenols');
        const polyphenolsGraphic = section.querySelector('.animation-hero__polyphenols-img');
        const header = document.querySelector('.header');

        if (!heroArea || !polyphenolsSection) return;

        // Split hero title into words for word-by-word animation
        if (heroTitle && !heroTitle.querySelector('.word-wrap')) {
          const text = heroTitle.textContent;
          const words = text.split(' ');
          heroTitle.innerHTML = words.map(word => 
            `<span class="word-wrap" style="display: inline-block; perspective: 1000px;">
              <span class="word" style="display: inline-block; transform-origin: center; transform-style: preserve-3d;">${word}</span>
            </span>`
          ).join(' ');
        }

        const titleWords = section.querySelectorAll('.animation-hero__title .word');

        // Create curtain overlay
        let curtain = section.querySelector('.hero-curtain-overlay');
        if (!curtain) {
          curtain = document.createElement('div');
          curtain.className = 'hero-curtain-overlay';
          curtain.style.cssText = `
            position: fixed;
            top: -100vh;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #000000 0%, #0a0a0a 100%);
            z-index: 9999;
            pointer-events: none;
          `;
          document.body.appendChild(curtain);
        }

        // Set initial states
        gsap.set(titleWords, { rotationX: 0, opacity: 1 });
        if (heroButton) gsap.set(heroButton, { opacity: 1 });
        if (heroBanner) gsap.set(heroBanner, { scale: 1, opacity: 1 });
        gsap.set(curtain, { yPercent: -100 });
        gsap.set(polyphenolsSection, { opacity: 0 });
        
        if (polyphenolsGraphic) {
          gsap.set(polyphenolsGraphic, { 
            rotationY: 0, 
            rotationX: 0, 
            transformStyle: 'preserve-3d' 
          });
        }
        
        // Header stays visible on page load

        // Phase 1: Hero exit animation (scroll-based, pinned)
        const heroExitTimeline = gsap.timeline({
          scrollTrigger: {
            trigger: section,
            start: 'top top',
            end: '+=150%',
            scrub: 1,
            pin: true,
            anticipatePin: 1,
            id: 'hero-pin',
            onLeaveBack: () => {
              // Reset if user scrolls back up
              curtainTransition.pause(0);
            }
          }
        });

        // Flip words UPWARD from RIGHT TO LEFT (DROP first)
        heroExitTimeline
          .to(titleWords, {
            rotationX: -90,
            opacity: 0,
            stagger: -0.1,  // DROP → EVERY → IN → HEALTH
            ease: 'power2.inOut',
            duration: 1
          }, 0);

        if (heroButton) {
          heroExitTimeline.to(heroButton, {
            opacity: 0,
            duration: 0.8,
            ease: 'power2.inOut'
          }, 0.2);
        }

        if (heroBanner) {
          heroExitTimeline.to(heroBanner, {
            scale: 1.5,
            opacity: 0,
            duration: 1,
            ease: 'power2.inOut'
          }, 0.3);
        }

        // Hide header during hero exit
        if (header) {
          heroExitTimeline.to(header, {
            yPercent: -100,
            opacity: 0,
            duration: 0.5,
            ease: 'power2.in'
          }, 0.5);
        }

        // Add callback at end of timeline to trigger curtain
        heroExitTimeline.call(() => {
          // Small delay to ensure scroll has stopped
          gsap.delayedCall(0.3, () => {
            curtainTransition.play();
          });
        });

        // Phase 2: Automatic curtain transition (time-based)
        const curtainTransition = gsap.timeline({
          paused: true,
          onStart: () => {
            // Make polyphenols visible before curtain reveals it
            gsap.set(polyphenolsSection, { opacity: 1 });
          },
          onComplete: () => {
            // Kill the scroll trigger completely after curtain
            const st = ScrollTrigger.getById('hero-pin');
            if (st) st.kill();
            // Remove curtain element
            curtain.remove();
          }
        });

        // Curtain pulls down to reveal polyphenols
        curtainTransition
          .to(curtain, {
            yPercent: 0,
            duration: 0.6,
            ease: 'power2.inOut'
          }, 0);

        // Header appears from top during curtain
        if (header) {
          curtainTransition.to(header, {
            yPercent: 0,
            opacity: 1,
            duration: 0.5,
            ease: 'power2.out'
          }, 0.1);
        }

        // Curtain continues down past viewport
        curtainTransition
          .to(curtain, {
            yPercent: 100,
            duration: 0.6,
            ease: 'power2.inOut'
          }, 0.8);

        // Phase 3: Polyphenols 3D rotation (normal scroll, not pinned)
        if (polyphenolsGraphic) {
          gsap.to(polyphenolsGraphic, {
            rotationY: 360,
            rotationX: 15,
            transformOrigin: 'center center',
            ease: 'none',
            scrollTrigger: {
              trigger: polyphenolsSection,
              start: 'top 80%',
              end: 'bottom 20%',
              scrub: 2,
            }
          });

          // Floating animation for oil drop effect
          gsap.to(polyphenolsGraphic, {
            y: '+=20',
            duration: 2,
            ease: 'sine.inOut',
            yoyo: true,
            repeat: -1
          });
        }

        // Add perspective for 3D effects
        section.style.perspective = '1200px';
        section.style.perspectiveOrigin = 'center center';
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAnimationHero);
    } else {
      initAnimationHero();
    }

    window.addEventListener('resize', () => {
      if (typeof ScrollTrigger !== 'undefined') {
        ScrollTrigger.refresh();
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Animation hero",
  "tag": "section",
  "class": "section-animation-hero",
  "settings": [
    {
      "type": "header",
      "content": "Hero area"
    },
    {
      "type": "text",
      "id": "hero_heading",
      "label": "Hero heading",
      "default": "Health in every drop"
    },
    {
      "type": "text",
      "id": "hero_button_text",
      "label": "Hero button text",
      "default": "Try baseline"
    },
    {
      "type": "url",
      "id": "hero_button_link",
      "label": "Hero button link"
    },
    {
      "type": "header",
      "content": "Hero banner image"
    },
    {
      "type": "image_picker",
      "id": "hero_banner_image",
      "label": "Banner image"
    },
    {
      "type": "header",
      "content": "Powered by Polyphenols"
    },
    {
      "type": "text",
      "id": "polyphenols_heading",
      "label": "Polyphenols heading",
      "default": "Powered by polyphenols"
    },
    {
      "type": "richtext",
      "id": "polyphenols_text",
      "label": "Polyphenols text",
      "default": "<p>Polyphenols are <strong>potent antioxidants</strong> that help protect your body from <strong>free radicals</strong> and <strong>oxidative stress</strong>.</p>"
    },
    {
      "type": "text",
      "id": "polyphenols_button_text",
      "label": "Polyphenols button text",
      "default": "Take the 3-minute polyphenol journey"
    },
    {
      "type": "url",
      "id": "polyphenols_button_link",
      "label": "Polyphenols button link"
    },
    {
      "type": "image_picker",
      "id": "polyphenols_image",
      "label": "Polyphenols graphic (e.g. droplet)"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 300,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Animation hero"
    }
  ]
}
{% endschema %}
